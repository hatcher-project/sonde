!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("HatcherSonde",t):e.HatcherSonde=t()}(this,function(){"use strict";function e(e){return e<1e3?e+"&micro;s":e<1e6?(e/1e3).toFixed(2)+"ms":(e/1e6).toFixed(2)+"s"}function t(e,t,o,i){var s=document.createElement(e);if(t&&(s.innerHTML=t),o)for(var n=o.split(" "),r=0;r<n.length;r++)s.classList.add(n[r]);if(i)for(var a in i)s.setAttribute(a,i[a]);return s}var o=function(e){var t=this;this.bar=e,this.root=document.createElement("header");var o=document.createElement("div");this.root.appendChild(o),o.innerHTML="logo",this.reportSelect=document.createElement("select");var i=document.createElement("div");i.classList.add("phpsonde-request-select"),i.appendChild(this.reportSelect),this.root.appendChild(i),this.reportSelect.addEventListener("change",function(){e.showReport(this.value)}),this.itemList=document.createElement("ul"),this.root.appendChild(this.itemList),o.addEventListener("click",function(){t.bar.toggle()}),e.on("reportAdded",function(o){var i=new Option(o.label,e.reports.length-1);t.reportSelect.options[t.reportSelect.options.length]=i}),e.on("showReport",function(o){t.showReport(e.reports[o])})};o.prototype.showReport=function(e){for(var t=this;this.itemList.lastChild;)t.itemList.removeChild(t.itemList.lastChild)},o.prototype.addPanelTab=function(e,o){var i=t("li",e,"phpsonde-panel-tab");this.itemList.appendChild(i);var s=this;1===this.itemList.children.length&&(i.classList.add("phpsonde-open"),o.classList.add("phpsonde-open")),i.addEventListener("click",function(){for(var e=s.bar.root.querySelectorAll(".phpsonde-panel-tab.phpsonde-open, .phpsonde-panel.phpsonde-open"),t=0;t<e.length;t++)e[t].classList.remove("phpsonde-open");i.classList.add("phpsonde-open"),o.classList.add("phpsonde-open"),s.bar.open()})};var i=function(e){if(!e||"string"!=typeof e)throw new Error("Event name should be a valid non-empty string!")},s=function(e){if("function"!=typeof e)throw new Error("Handler should be a function!")},n=function(e,t){if(e&&e.indexOf(t)<0)throw new Error('Event "'+t+'" is not allowed!')},r=Object.freeze({allowedEvents:Symbol("allowedEvents"),listeners:Symbol("listeners")}),a=function(e){if(void 0!==e&&!Array.isArray(e))throw new Error("Allowed events should be a valid array of strings!");this[r.listeners]=new Map,this[r.allowedEvents]=e};a.prototype.on=function(e,t){i(e),n(this[r.allowedEvents],e),s(t);var o=this[r.listeners].get(e);o||(o=new Set,this[r.listeners].set(e,o)),o.add(t)},a.prototype.once=function(e,t){var o=this;s(t);var i=function(s){o.off(e,i),t.call(o,s)};this.on(e,i)},a.prototype.off=function(e,t){i(e),n(this[r.allowedEvents],e),s(t);var o=this[r.listeners].get(e);o&&(o.delete(t),o.size||this[r.listeners].delete(e))},a.prototype.offAll=function(e){if(void 0===e)return void this[r.listeners].clear();i(e),n(this[r.allowedEvents],e);var t=this[r.listeners].get(e);t&&(t.clear(),this[r.listeners].delete(e))},a.prototype.emit=function(e,t){var o=this;i(e),n(this[r.allowedEvents],e);var s=this[r.listeners].get(e);s&&s.forEach(function(e){try{e.call(o,t)}catch(e){console.error(e)}})},a.prototype.hasListeners=function(e){return i(e),n(this[r.allowedEvents],e),this[r.listeners].has(e)},a.mixin=function(e,t){if(!e||"object"!=typeof e)throw new Error("Object to mix into should be valid object!");if(void 0!==t&&!Array.isArray(t))throw new Error("Allowed events should be a valid array of strings!");var o=new a(t);return["on","once","off","offAll","emit","hasListeners"].forEach(function(t){if(void 0!==e[t])throw new Error('Object to mix into already has "'+t+'" property defined!');"constructor"!==t&&(e[t]=o[t].bind(o))},o),e};var d=function(e){var o=this;this.bar=e,this.root=t("div",null,"phpsonde-panel phpsonde-timeline-panel"),this.header=t("header","Show "),this.root.appendChild(this.header),this.typeSelector=document.createElement("select"),this.header.appendChild(this.typeSelector),this.typeSelector.addEventListener("change",function(){o.filterType(this.value)}),this.itemList=document.createElement("ul"),this.root.appendChild(this.itemList),e.on("showReport",function(t){o.showReport(e.reports[t])})};d.prototype.showReport=function(o){for(var i=this;this.itemList.lastChild;)i.itemList.removeChild(i.itemList.lastChild);var s=o.data.duration;if(!s)throw"No valid duration for profile";this.bar.header.addPanelTab(e(s),this.root);for(var n={},r=0;r<o.data.profiles.length;r++)!function(r){var a=o.data.profiles[r],d=i.bar.profileTypes.hasOwnProperty(a.type)?a.type:"default",p=i.bar.profileTypes[d];n.hasOwnProperty(a.type)||(n[a.type]=p.label||a.type);var l=document.createElement("li");l.setAttribute("data-phpsonde-type",a.type);var h=document.createElement("div");l.appendChild(h),h.classList.add("phpsonde-summary");var c=document.createElement("div");c.classList.add("phpsonde-label"),h.appendChild(c),c.innerHTML=p.label||a.type;var f=document.createElement("div");f.classList.add("phpsonde-duration"),f.innerHTML=e(a.stop-a.start),h.appendChild(f);var v=document.createElement("div"),u=document.createElement("div");u.classList.add("phpsonde-timebar"),u.appendChild(v),h.appendChild(u);var m=100*a.start/s,y=100*(a.stop-a.start)/s;v.style["margin-left"]=m+"%",v.style.width=y>0?y+"%":"1px",p.color&&(v.style["background-color"]=p.color);var L=document.createElement("div");if(L.classList.add("phpsonde-details"),l.appendChild(L),a.data&&Object.keys(a.data).length>0){var b=t("div",null,"phpsonde-data-details");b.appendChild(t("h3","Details")),L.appendChild(b);var w=t("table");b.appendChild(w);for(var E in a.data){var g=t("tr");w.appendChild(g),g.appendChild(t("td",E)),g.appendChild(t("td",a.data[E]))}}var C=document.createElement("div");C.classList.add("phpsonde-stacktrace");var S=document.createElement("pre");S.innerHTML=a.trace,C.appendChild(t("h3","Stack Trace")),C.appendChild(S),L.appendChild(C),h.addEventListener("click",function(){L.classList.toggle("phpsonde-open")}),i.itemList.appendChild(l)}(r);for(;this.typeSelector.options.length;)i.typeSelector.options.remove(0);var a=new Option("All",-1);this.typeSelector.options[0]=a;for(var d in n){var p=new Option(n[d],d);i.typeSelector.options[i.typeSelector.options.length]=p}},d.prototype.filterType=function(e){var t=this;if(-1==e)for(var o=0;o<this.itemList.children.length;o++)t.itemList.children[o].classList.remove("phpsonde-hidden");else for(var i=0;i<this.itemList.children.length;i++){var s=t.itemList.children[i];s.getAttribute("data-phpsonde-type")===e?t.itemList.children[i].classList.remove("phpsonde-hidden"):t.itemList.children[i].classList.add("phpsonde-hidden")}};var p=function(e){var o=this;this.bar=e,this.root=t("div","","phpsonde-panel phpsonde-messages-panel"),this.itemList=t("ul"),this.root.appendChild(this.itemList),e.on("showReport",function(t){o.showReport(e.reports[t])})};p.prototype.showReport=function(e){for(var o=this;this.itemList.lastChild;)o.itemList.removeChild(o.itemList.lastChild);var i=e.data.messages;if(i){var s=t("span",i.length,"phpsonde-bubble");this.bar.header.addPanelTab("messages "+s.outerHTML,this.root);for(var n=0;n<i.length;n++){var r=i[n],a=t("li","&rsaquo; "+r.text,"bar");o.itemList.appendChild(a)}}};var l=function(){this.root=document.createElement("div"),this.root.classList.add("phpsonde"),this.header=new o(this),this.root.appendChild(this.header.root),this.body=document.createElement("div"),this.body.classList.add("phpsonde-body"),this.root.appendChild(this.body),this.timeline=new d(this),this.body.appendChild(this.timeline.root),this.messages=new p(this),this.body.appendChild(this.messages.root),document.body.appendChild(this.root),this.reports=[],this.profileTypes={default:{color:"#AAA"}}};return l.prototype.open=function(){this.root.classList.add("phpsonde-open")},l.prototype.close=function(){this.root.classList.remove("phpsonde-open")},l.prototype.toggle=function(){this.root.classList.toggle("phpsonde-open")},l.prototype.addProfileType=function(e,t){this.profileTypes[e]=t},l.prototype.addReport=function(e,t){var o={label:e,data:t};this.reports.push(o),this.emit("reportAdded",o),1===this.reports.length&&this.showReport(0)},l.prototype.showReport=function(e){this.emit("showReport",e)},a.mixin(l.prototype),{Bar:l}});
//# sourceMappingURL=index.js.map
